---
output:
  pdf_document: default
  html_document: default
---

# Introduction

Ecological dynamic models describe how ecological processes drive populations to change over time. These models often account for both process error and observation error. State-space models allow for the estimation of parameters of the deterministic process, observation error, and process error from a single time series [@bolkerEcologicalModelsData2008]. However, estimating parameters for state-space models is challenging. One simplification is to assume that the dynamic model only has observation error. This can be done by starting with the initial conditions of the system and computing the entire trajectory over the domain at once. This approach assumes there is no uncertainty in the predicted values of the states at each time step, meaning there is no process error. Since the trajectory at every time step is determined solely by the starting parameters and initial conditions, the model is deterministic. The only error accounted for is the difference between observed and predicted values.

To fit the model to data and compute the maximum likelihood estimate (MLE) for a given set of parameters, one assumes independent observations and sums the likelihood for each observation based on the chosen model of observation error. Using a quasi-Newton method, parameter estimates are updated based on the current iteration of trajectory matching until convergence is achieved. If the observation error is normally distributed with constant variance, this process simplifies to least squares fitting.

When there are unobserved variables in the model, a simple approach is to treat these variables as fixed parameters. In modeling infectious diseases, for example, one may be interested in estimating the unobserved transmission rate between an infectious individual and a susceptible one. Assuming a fixed value for the transmission rate at every time step is often inaccurate because many diseases have dynamic transmission rates influenced by factors such as seasonality or non-pharmaceutical interventions (e.g., social distancing, masking, and changes in mobility patterns). Therefore, it is reasonable to assume that the transmission rate is a time-varying parameter, computed at each observed data point.

A standard method for dealing with time-varying parameters is to assume a stochastic model of the latent variable, introducing a parametric model and estimating its parameters as part of the MLE process. However, imposing a particular shape on the unknown function describing the latent variable, based on a specific statistical distribution, is often a phenomenological characterization rather than one derived from known biological mechanisms. This can lead to mismatches between the model and data not due to biological inaccuracies but due to the chosen parametric form of the latent variable.

Fitting non-stochastic dynamic ecological models with time-varying latent variables is challenging. Instead of specifying the functional form of the unknown function a priori, we can use a method that allows for more flexible function estimation, minimizing incidental assumptions and model misspecification. Simon Wood [@woodPartiallySpecifiedEcological2024] describes a methodology using penalized smoothing to estimate time-varying latent variables for non-stochastic dynamic ecological models. He introduces what he calls the partially specified modeling framework, also known as semi-mechanistic models. The basic idea is to use deterministic specifications and parametric models for components backed by known biological mechanisms while employing non-parametric methods for flexible function estimation when insufficient information is available to justify a structured parametric form.

Implementing Wood's methodology requires expertise in statistical inference, non-linear optimization, spline literature, numerical analysis, and statistical computing, making it complex for many domain-specific modelers. Our goal was to develop a user-friendly way for modelers to estimate time-varying latent variables in non-stochastic compartmental models. We integrated Simon Wood's methodology for smoothing parameter estimation into the general-purpose compartmental modeling tool `macpan2`, which utilizes `TMB` for optimization. We use the `mgcv` package in R to obtain low-rank smoothing matrices for the basis and penalty, resulting in a software module within `macpan2` that allows users to easily formulate and fit semi-mechanistic models.

Being able to quickly and easily estimate the transmission rate at each observation is crucial for infectious disease modelers. The transmission rate is integral to calculating other epidemiological quantities, such as the effective reproduction number (\(R_t\)), and provides the basis for many downstream applications, including evaluating intervention strategies, forecasting disease dynamics, identifying high-risk periods and populations, validating models, understanding transmission dynamics, assessing the impact of variants, and developing and testing hypotheses about factors influencing disease spread.

In Chapter \ref{Background}, we review the basic theory of univariate smoothing in the context of Gaussian regression and fitting compartmental models to data. We discuss the construction of linear smoothers, review different bases available in the R package `mgcv`, explore general penalized likelihood methods, and examine the relationship between smooths and random effects, including a Bayesian perspective. Chapter \ref{Materials-and-methods} covers the technical details required to implement the smoothing parameter estimation methodology in `macpan2`. Chapter \ref{Results} presents the results of the simulation study and applications to Scarlet Fever, COVID-19, and Measles datasets. Finally, Chapter \ref{Discussion} discusses the results, the assumptions and simplifications used in our modeling methodology, and future research avenues.


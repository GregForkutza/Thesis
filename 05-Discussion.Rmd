---
output:
  pdf_document: default
  html_document: default
---
# Discussion {#Discussion}

This thesis presents a method for formulating infectious disease compartmental models without relying on unjustified biological assumptions about the disease transmission process, as required by fixed or parametric models. By integrating this approach into the `macpan2` and `TMB` frameworks, we provide a user-friendly way for modelers to fit models, select the best model, and infer estimates of latent variables over time. We accomplished this by adapting the general methodology of Simon Wood [@woodPartiallySpecifiedEcological2024] and utilizing it in conjunction with the aforementioned model formulation tool and optimization engine.

Our work differs from that of Simon Wood by making this methodology accessible to quantitatively minded modelers who may not be experts in nonlinear optimization and smoothing theory. This was achieved because `macpan2` is designed from a software-engineering perspective. It wraps all the necessary `C++` code to interact with `TMB` in an `R` wrapper, eliminating the need for modelers to write bespoke optimization code, which can be a significant barrier to using such models.

Through simulation studies, we demonstrated the efficacy of penalized smoothing parameter estimation. The `mgcv` package greatly facilitated the construction of low-rank smoothing bases and penalty matrices for a given domain and model granularity. We compared different smoothing bases, evaluating their performance based on uncertainty estimates, AIC scores, and the shapes of the estimated functions.

We successfully fitted the models to real-world incidence data, with the goodness of fit controlled by smoothness inferred through penalization. These results indicate that this methodology can be beneficial to any modeler wishing to estimate a time-varying latent variable by inferring the shape of an unknown function. Although we focused on modeling infectious disease with unknown transmission rates and reproduction numbers, it seems reasonable that this approach can be applied to arbitrary compartmental models with unknown time-varying functions. This methodology can even extend to dynamic ecological models formulated using compartmental models.

The models were effective in inferring fixed parameters. Unlike most epidemiological studies [@elderdWarmerTemperaturesIncrease2014; @fosterEstimatingR0Early2022], we did not fix the recovery rate and the initial number of infected individuals to their initial values. Instead, we introduced flexibility by applying a sharp partial Bayesian log-normal prior, treating the quantile of this prior as a parameter calibrated using the data. For future research, a fully Bayesian approach could be adopted by specifying prior distributions for both the mean and variance of the log-normal distribution.

The relative performance of different smoothing bases across all examples can be analyzed. In all examples (subsections \ref{simulation}, \ref{scarlet}, \ref{Ireland}, and \ref{Measles}), the Gaussian process (GP) regression smoothing basis consistently proved to be the best in several respects. The GP basis was the most robust to increases in effective degrees of freedom. Tables \ref{tab:aic-table-sim}, \ref{tab:aic-table-scarlet}, and \ref{tab:aic-table-ireland} show that during model fitting, selecting model complexity by adjusting the smoothing parameter \(\lambda\) resulted in an increase in the conditional AIC score. Checking the resultant effective degrees of freedom for the fitted models across different bases, the GP basis consistently showed the lowest values. This indicates that the GP basis, in conjunction with the `nlminb` optimizer used by `TMB`, is able to find the best smoothing parameter value compared to other bases. Additionally, across all datasets, the GP basis performed best or near-best. Notably, it was the only model capable of fitting the large measles dataset. Our conclusion is that using this methodology, a GP basis is generally an effective choice.

The SIR and SIRS compartmental models used in this work are basic compartmental models. Theoretically, a compartmental model can be as complex as the modeler wishes, but in practice, certain assumptions are made to make the fitting process tractable. The models we used serve as toy examples that demonstrate the proof of concept for the efficacy of the methodology presented in this thesis.

In contrast, more realistic compartmental models can be highly complex, including numerous compartments (or nodes) and connections (or edges) between them, each with associated parameters or unknown functions that need to be estimated. These models can account for various factors such as different stages of infection, varying rates of transmission, recovery, and immunity, as well as heterogeneity in the population.

Despite their simplicity, our models effectively demonstrate the potential of the methodology. However, they do not capture the full complexity of real-world scenarios, where the intricate dynamics of disease spread necessitate more sophisticated models. By starting with these simpler models, we establish a solid foundation for understanding and validating the methodology before potentially extending it to more complex and realistic compartmental models in future research.

Assuming the unknown function is simply linear, as done in this thesis (when the smoother parameter is fixed for each iteration), is a step towards constructing more complex forms of the unknown function. If the modeler wishes to incorporate biological information about the transmission process into the model, they might impose qualitative conditions on the unknown function. For instance, if the unknown function is assumed to be monotone, the modeler can impose specific conditions of monotonicity and boundedness on the smoother. Extending this methodology to include specific constraints on the smoother allows the literature to guide the shape of the fitted unknown function by applying qualitative constraints to the smoothing functional.

In summary, this thesis presents a proof of concept for estimating time-varying unknown functions in deterministic compartmental models. There are many possible avenues for extension, some of which we have discussed above. More generally, this thesis suggests that it should be possible to adapt this methodology to be used within any optimization framework that fits mixed models by using the theory of the duality of smooths and random effects, to rewrite the smoothing basis as random effects matrices, as discussed in subsection \ref{The-duality-of-smooths-and-random-effects}. Another avenue of research is to estimate more than one unknown function. All the methods presented here are easily extensible to fitting models to data with more than one unknown function, each with its own smoothing parameter. Wood [@woodGeneralizedAdditiveModels2017] and Gu [@chongguSmoothingSplineANOVA2013] describe how to formulate models with more than one smoothing parameter.